# Tables

(ref:table1Caption) The four components of the `r yr` Sablefish research and assessment survey.  
\ \
\ \


```{r table1, echo=FALSE}

#  Create a dataframe 4 columns wide
 Component<- c("Stratified random", "sampling (StRS),", "Type 3 (Random", "tagging)",
                "Traditional Inlet","Standardized", "", "" ,
                "Exploratory","","","",
                "Benthic impact","","","","") 
  Bait  <-    c("1 kg squid (bagged)", "4 kg hake (loose)", "","",
                "1 kg squid (bagged)", "", "", "" ,
                "1 kg squid (bagged)", "5 kg hake (loose)", "","",
                "Nuytco autonomous","camera system and","HOBO Pendant G","Loggers attached to","select traps") 
  
  Locations<- c("Five spatial strata", "(S1-S5)", "","",
                "Dean/Burke Channel", "Finlayson Channel", "Gil Island", "Portland Inlet" ,
                "Quatsino Sound", "","","",
                "Coastwide","","","","")
  
  Protocol <- c("1/3 of traps used for tagging,","1/3 of traps used for biosamples,", 
                "(50 piece LS(W)MO),","1/3 of traps discarded",
                "1/2 of traps used for tagging,","1/2 of traps used for biosamples","(50 piece LSWMO)","" ,
                "1/3 of traps used for biosamples"," (50 piece LSWMO),","1/3 of traps used for tagging","and 1/3 of traps discarded",
                "Camera system deployed on","select sets.  Accelerometers","deployed on camera and survey", "sets.","" )
  
  component        <-   data.frame(Component, Bait, Locations, Protocol)
  names(component) <-   c('Component', 'Bait/Method', 'Locations', 'Protocol')
  
       kableExtra::kable(component, booktabs = TRUE,linesep = "",
                   format = "latex",
                   caption = "(ref:table1Caption)")%>%
                   row_spec(0,    bold = T) %>%
                   row_spec(4,  hline_after = T) %>%
                   row_spec(8,  hline_after = T) %>%
                   row_spec(12,  hline_after = T) %>%         
       kableExtra::kable_styling(font_size = 10, position = "left",latex_options = "hold_position")

```
\ \
\ \
\ \

(ref:table2Caption) Spatial strata allocation for the stratified random survey design and completed strata counts (magenta) for the `r yr` sablefish research and assessment survey.
\ \
\ \

```{r table2, echo=FALSE}

       Strata      <- c("S1 (South West Coast Vancouver Island or SWCVI)",
                        "S2 (North West Coast Vancouver Island or NWCVI)",
                        "S3 (Queen Charlotte Sound or QCS)",
                        "S4 (South West Coast Haida Gwaii or SWCHG)",
                        "S5 (North West Coast Haida Gwaii or NWCHG)",
                        "Total ")
       act.strata  <- paste("select Year, DEPTH_STRATUM, SPATIAL_STRATUM, COUNT([SET]) AS sets ",
                           "from dbo.GFBIO_RESEARCH_TRIPS ",
                           "group by Year, DEPTH_STRATUM, SPATIAL_STRATUM ",
                           "having (Year = ", yr, " )", sep="")
       #surv.strata <- GetSQLData(act.strata,"Sablefish")
       #write.table(surv.strata, file = paste(path,"table02.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
       surv.strata <-  read.csv(paste(path,'table02.csv',sep=''), header=T)

       RD1      <- c(7,7,14,6,7,41)
       RD1fish  <- surv.strata$sets[surv.strata$DEPTH_STRATUM =="RD1"]
       RD1fish[6]  <- sum(surv.strata$sets[surv.strata$DEPTH_STRATUM =="RD1"])
       RD2fish  <- surv.strata$sets[surv.strata$DEPTH_STRATUM =="RD2"]
       RD2fish[6]  <- sum(surv.strata$sets[surv.strata$DEPTH_STRATUM =="RD2"])
       RD3fish  <- surv.strata$sets[surv.strata$DEPTH_STRATUM =="RD3"]
       RD3fish[6]  <- sum(surv.strata$sets[surv.strata$DEPTH_STRATUM =="RD3"])     
       RD2      <- c(8,7,6,6,7,34)
       RD3      <- c(8,8,6,6,7,35)
       Total    <- c(23,22,26,18,21,110)
       Totfish  <- c(RD1fish[1]+RD2fish[1]+RD3fish[1], RD1fish[2]+RD2fish[2]+RD3fish[2],
                     RD1fish[3]+RD2fish[3]+RD3fish[3], RD1fish[4]+RD2fish[4]+RD3fish[4],
                     RD1fish[5]+RD2fish[5]+RD3fish[5], RD1fish[6]+RD2fish[6]+RD3fish[6]) # addition
       dataf    <- data.frame(Strata, RD1, RD1fish, RD2, RD2fish,RD3, RD3fish, Total, Totfish) 
       yrRD1    <- paste("RD1 ",yr,sep="")
       yrRD2    <- paste("RD2 ",yr,sep="")
       yrRD3    <- paste("RD3 ",yr,sep="")
       yrTot    <- paste("Total ",yr,sep="")
       
       colnames(dataf) <- c("Spatia Strata", "RD1",yrRD1, "RD2",yrRD2,"RD3",yrRD3,"Total",yrTot)
   
       kableExtra::kable(dataf, booktabs = TRUE,linesep = "",
                   format = "latex",
                   caption = "(ref:table2Caption)") %>%
              row_spec(0,    bold = T) %>%
              row_spec(5, hline_after = T) %>%
              column_spec(2, width  = "0.5cm") %>%
              column_spec(3, width  = "0.5cm", color="magenta" ) %>%
              column_spec(4, width  = "0.5cm") %>%
              column_spec(5, width  = "0.5cm", color="magenta") %>% 
              column_spec(6, width  = "0.5cm") %>% 
              column_spec(7, width  = "0.5cm", color="magenta") %>%          
              column_spec(8, width  = "0.7cm") %>%
              column_spec(9, width  = "0.5cm", color="magenta") %>% 
              row_spec(0, color="black") %>%
              row_spec(6, bold=T) %>%
              add_header_above(c(" "= 1, "Depth Strata" = 6, " " = 2), bold=T) %>%
       kableExtra::kable_styling(font_size = 10, position = "left",latex_options = "hold_position")
  
  
```
\ \
\ \
(ref:table3Caption) Summary of species captured during the `r yr` survey StRS sets conducted by the `r boat`. No value in the weight column indicates that the catch was not weighed. 
\ \
\ \


```{r table3,  echo=FALSE}

    options(knitr.kable.NA = '')
    dtSP   <- paste("exec procRReport_SpeciesSummary ",yr," ,'StRS'",sep="")
    #datSP  <- GetSQLData(dtSP,"Sablefish")
    #write.table(datSP, file = paste(path,"table03.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
    datSP  <-  read.csv(paste(path,'table03.csv',sep=''), header=T)
       
    dat1SP <- datSP[,c(-1)] 
    dat1SP <- dat1SP[,c(-3)]
    dat1SP <- dat1SP[,c(-2)]
    dat1SP <- dat1SP[,c(-6)]  # trim columns
    cleandataSP<-dat1SP
    cleandataSP$Summary_sp <- cleanf(cleandataSP$Summary_sp)  #  remove duplicates function
    colnames(cleandataSP)  <- c( "Category", "Common Name", "Scientific Name" , "Count", "Weight(kg)")
    
    kableExtra::kable(cleandataSP,
                      booktabs = TRUE,linesep = "",
                      longtable = T,
                      format = "latex",  caption = "(ref:table3Caption)") %>%
                      row_spec(0,    bold = T) %>%
                      row_spec(13,  hline_after = T) %>%
                      row_spec(25,  hline_after = T) %>%
                      row_spec(29,  hline_after = T) %>%
      
    kableExtra::kable_styling(font_size = 8, 
                              latex_options = "repeat_header",
                              position = "left",
                              repeat_header_text = "continued.", 
                              repeat_header_method = "replace"
                              )
   
```
(ref:table4Caption) Summary of species captured by the `r boat` during the `r yr` survey standardized sets conducted at mainland inlet localities. Null values indicate the catch was not counted or weighed.  No value in both weight and count indicates trace weights of less than 1 kg recorded.
\ \
\ \

```{r table4, echo=FALSE}

  options(knitr.kable.NA = '')
  dtSP   <- paste("exec procRReport_SpeciesSummary ",yr," ,'INLET STANDARDIZED'",sep="")
  #datSP  <- GetSQLData(dtSP,"Sablefish")
  #write.table(datSP, file = paste(path,"table04.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
  datSP   <-  read.csv(paste(path,'table04.csv',sep=''),header=T)
  
  dat1SP <- datSP[,c(-1)] 
  dat1SP <- dat1SP[,c(-3)]
  dat1SP <- dat1SP[,c(-2)]
  dat1SP <- dat1SP[,c(-6)]
  cleandataSPi<-dat1SP
  cleandataSPi$Summary_sp <- cleanf(cleandataSPi$Summary_sp)  #use the remove duplicates function
  colnames(cleandataSPi)  <- c( "Category", "Common Name", "Scientific Name" , "Count", "Weight(kg)")

  kableExtra::kable(cleandataSPi,
                    booktabs = TRUE,linesep = "",
                    format = "latex",  caption = "(ref:table4Caption)") %>%
                    row_spec(0,    bold = T) %>%
                    row_spec(4,  hline_after = T) %>%
                    row_spec(8,  hline_after = T) %>%
                    row_spec(11,  hline_after = T) %>%
  kableExtra::kable_styling(font_size = 8, position = "left",latex_options = "hold_position")

```

(ref:table5Caption) Summary of species captured by the `r boat` during the `r yr` survey Total count and weight of species captured during the 2012 survey at the exploratory sites.  
\ \
\ \

```{r table5, echo=FALSE}

  options(knitr.kable.NA = '')
  Category   <- c("Roundfish species",
                  "Rockfish species") 
  CommonName <- c("Sablefish",
                  "Pacific ocean perch")
  ScientificName  <-  c("ANOPLOPOMA FIMBRIA",
                        "SEBASTES ALUTUS")
  TotalCnt<- c("1","1")
  Totalwt <- c("3","1")
  component               <-   data.frame(Category, CommonName, ScientificName, TotalCnt, Totalwt)
  colnames(component)  <-   c( "Category", "Common Name", "Scientific Name" , "Count", "Weight(kg)")
  

  kableExtra::kable(component,
                    booktabs = TRUE,linesep = "",
                    format = "latex",  caption = "(ref:table5Caption)") %>%
                    row_spec(0,  bold = T) %>%
                    row_spec(4,  hline_after = T) %>%
                    row_spec(8,  hline_after = T) %>%
                    row_spec(11, hline_after = T) %>%
  kableExtra::kable_styling(font_size = 9, position = "left",latex_options = "hold_position")



```
\ \
\ \
(ref:table6Caption) Summary of sablefish fork length measurements collected during the `r yr` stratified random sets by spatial and depth stratum.
\ \
\ \

```{r table6, echo=FALSE}

    #newdata2   <-   rbind(newdata,biosumm)
    newdata2    <-   newdata  # created in results section

    kableExtra::kable(newdata2, row.names = FALSE,
                booktabs = TRUE,   linesep = "",
                format = "latex",  caption = "(ref:table6Caption)") %>% 
    add_header_above(c("Depth Strata/Locality"= 2,
                        "Proportion" = 2, 
                        "Mean Fork Length (mm)" = 3),bold=T) %>%
      
    kableExtra::kable_styling(font_size = 9, position = "left", latex_options = "hold_position") %>%
                row_spec(0,    bold = T) %>%
                row_spec(3,    hline_after = T) %>%
                row_spec(4,    bold = T, hline_after = T) %>%
                row_spec(7,    hline_after = T) %>% 
                row_spec(8,    bold = T, hline_after = T) %>%      
                row_spec(11,   hline_after = T) %>%
                row_spec(12,   bold = T, hline_after = T) %>%      
                row_spec(15,   hline_after = T)   %>% 
                row_spec(16,   bold = T, hline_after = T) %>%   
                row_spec(19,   hline_after = T)   %>% 
                row_spec(20,   bold = T)
      
```
\clearpage


(ref:table7Caption) Sablefish tag recovery counts by distance from release site and years at liberty before re-release for the 2020 survey. Distances were determined using the great circle distance between the survey release location and survey recovery location.
\ \
\ \


```{r table7, echo=FALSE}

       # in('A00545713','A00984002','A00254854') 3 tags re-released twice
       # in('A00733036','A00315966','A00550705')
      # in('A00545713','A00984002','A00254854','A00733036','A00315966','A00550705') 

      tag  <- paste("select * from Report_Survey_Tag_Recoveries",sep="") # have to go in database and change the year value
      #tag.rec <- GetSQLData(tag,"FishTag")
      #write.table(tag.rec, file = paste(path,"table06.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
      tag.rec <-  read.csv(paste(path,'table06.csv',sep=''), header=T)
      
      tag.rec[is.na(tag.rec)] <- 0   # convert NA to zero in whole table
      tag.rec$YearGroups      <- as.character(tag.rec$YearGroups)  # change column to character
      tag.rec$YearGroups      <- gsub("Grp1.", "", tag.rec$YearGroups)
      tag.rec$YearGroups      <- gsub("Grp2.", "", tag.rec$YearGroups)
      tag.rec$YearGroups      <- gsub("Grp3.", "", tag.rec$YearGroups)  
      tag.rec$YearGroups      <- gsub("Grp4.", "", tag.rec$YearGroups)      
      tag.rec$Recoveries      <- as.numeric(rowSums(tag.rec[,2:8], na.rm=TRUE))
      
      ad.row <- c('Total Counts',sum(tag.rec$X.10.km),sum(tag.rec$X11.50.km),sum(tag.rec$X51.100.km),
                          sum(tag.rec$X101.250.km),sum(tag.rec$X251.500.km),sum(tag.rec$X501.1000.km),
                          sum(tag.rec$X.1000.km), sum(tag.rec$Recoveries) )
      tag.rec2 <- rbind(tag.rec,ad.row) 

      names(tag.rec2) <- c("Years at Liberty","<10","11-50","51-100","101-250","251-500","501-1000","1000+","Recovery count")
   
      kableExtra::kable(tag.rec2, row.names = FALSE,
                booktabs = TRUE,   linesep = "",
                format = "latex",  caption = "(ref:table7Caption)") %>% 
      add_header_above(c(" "= 1,
                        "Distance (km) from Release Location" = 7, 
                        " " = 1),bold=T) %>% 
      
       kableExtra::kable_styling(font_size = 9, position = "left", latex_options = "hold_position") %>%
                row_spec(0,    bold = T) %>%
                row_spec(4, hline_after = T) %>%
                column_spec(2, width  = "1.1cm") 

```
\ \
\ \
(ref:table8Caption) List of the North Pacific spiny dogfish tagged with pop-off satellite tags. The tube label and tag number identify the dogfish.  The GFBIO specimen identifier is included for database reference.
\ \
\ \

```{r table8, echo=FALSE}

     query  <- paste("select DATENAME(mm,GFBioSQL.dbo.SAMPLE.SAMPLE_DATE) + ' '+  ",
               "cast(day(GFBioSQL.dbo.SAMPLE.SAMPLE_DATE) as varchar) +','+ ",
               "cast(year(GFBioSQL.dbo.SAMPLE.SAMPLE_DATE) as varchar) as Date,  ",
               "GFBioSQL.dbo.FISHING_EVENT.FE_MAJOR_LEVEL_ID as [Set],  ",
               "GFBioSQL.dbo.SPECIMEN.PRIMARY_TAG_NUMBER AS [Tube label - tag number],  ",
               "GFBioSQL.dbo.SPECIMEN_MORPHOMETRICS.SPECIMEN_MORPHOMETRICS_VALUE AS [Precaudal length (mm)],  ",
               "LEFT(MAJOR_STAT_AREA_1.MAJOR_STAT_AREA_NAME, 2) AS [Release Area],   ",
               "GFBioSQL.dbo.SPECIMEN.SPECIMEN_ID as [GFBio Specimen id]  ",
               "from  GFBioSQL.dbo.TRIP INNER JOIN  ",
               "GFBioSQL.dbo.FISHING_EVENT ON GFBioSQL.dbo.TRIP.TRIP_ID = GFBioSQL.dbo.FISHING_EVENT.TRIP_ID INNER JOIN   ",
               "GFBioSQL.dbo.FISHING_EVENT_CATCH ON GFBioSQL.dbo.FISHING_EVENT.FISHING_EVENT_ID = GFBioSQL.dbo.FISHING_EVENT_CATCH.FISHING_EVENT_ID INNER JOIN   ",
               "GFBioSQL.dbo.CATCH ON GFBioSQL.dbo.FISHING_EVENT_CATCH.CATCH_ID = GFBioSQL.dbo.CATCH.CATCH_ID INNER JOIN   ",
               "GFBioSQL.dbo.MAJOR_STAT_AREA ON GFBioSQL.dbo.FISHING_EVENT.MAJOR_STAT_AREA_CODE = GFBioSQL.dbo.MAJOR_STAT_AREA.MAJOR_STAT_AREA_CODE INNER JOIN   ",
               "GFBioSQL.dbo.CATCH_SAMPLE ON GFBioSQL.dbo.CATCH.CATCH_ID = GFBioSQL.dbo.CATCH_SAMPLE.CATCH_ID INNER JOIN   ",
               "GFBioSQL.dbo.SAMPLE ON GFBioSQL.dbo.CATCH_SAMPLE.SAMPLE_ID = GFBioSQL.dbo.SAMPLE.SAMPLE_ID INNER JOIN  ",
               "GFBioSQL.dbo.SPECIMEN ON GFBioSQL.dbo.SAMPLE.SAMPLE_ID = GFBioSQL.dbo.SPECIMEN.SAMPLE_ID INNER JOIN  ",
               "GFBioSQL.dbo.MAJOR_STAT_AREA AS MAJOR_STAT_AREA_1 ON GFBioSQL.dbo.FISHING_EVENT.MAJOR_STAT_AREA_CODE =   ",
               "MAJOR_STAT_AREA_1.MAJOR_STAT_AREA_CODE INNER JOIN  ",
               "GFBioSQL.dbo.SPECIMEN_MORPHOMETRICS ON GFBioSQL.dbo.SPECIMEN.SPECIMEN_ID = GFBioSQL.dbo.SPECIMEN_MORPHOMETRICS.SPECIMEN_ID  ",
               "where  (GFBioSQL.dbo.FISHING_EVENT.FE_SUB_LEVEL_ID IS NULL)  ",
               "GROUP BY YEAR(GFBioSQL.dbo.TRIP.TRIP_START_DATE), GFBioSQL.dbo.TRIP.TRIP_ID,   ",
               "GFBioSQL.dbo.FISHING_EVENT.FE_MAJOR_LEVEL_ID, GFBioSQL.dbo.CATCH.SPECIES_CODE,   ",
               "GFBioSQL.dbo.SPECIMEN.PRIMARY_TAG_NUMBER, GFBioSQL.dbo.FISHING_EVENT.FISHING_EVENT_ID,   ",
               "GFBioSQL.dbo.CATCH.CATCH_ID, GFBioSQL.dbo.SAMPLE.SAMPLE_ID, GFBioSQL.dbo.SPECIMEN.SPECIMEN_ID,   ",
               "GFBioSQL.dbo.SAMPLE.SAMPLE_DATE, GFBioSQL.dbo.SPECIMEN_MORPHOMETRICS.SPECIMEN_MORPHOMETRICS_VALUE,   ",
               "LEFT(MAJOR_STAT_AREA_1.MAJOR_STAT_AREA_NAME, 2)   ",
               "having (GFBioSQL.dbo.CATCH.SPECIES_CODE = '044') AND (GFBioSQL.dbo.TRIP.TRIP_ID = 73190)   ", 
               "AND (NOT (GFBioSQL.dbo.SPECIMEN.PRIMARY_TAG_NUMBER IS NULL))  ",
               "ORDER BY GFBioSQL.dbo.FISHING_EVENT.FE_MAJOR_LEVEL_ID", sep='')

    #popoff.tags <- GetSQLData(query,"Sablefish")
    #write.table(popoff.tags, file = paste(path,"table07.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
     popoff.tags <-  read.csv(paste(path,'table07.csv',sep=''), header=T)
     
     names(popoff.tags) <- c("Date","Set","Tube-tag ID","Precaudal length (mm)","Release Area","GFBio Specimen ID")
    
     kableExtra::kable(popoff.tags, row.names = FALSE,
                align=c('l', 'c','l','l','l','c'),
                booktabs = TRUE,   linesep = "",
                format = "latex",  caption = "(ref:table8Caption)") %>% 

       kableExtra::kable_styling(font_size = 9, position = "left", latex_options = "hold_position") %>%
                row_spec(0,    bold = T) %>%
                column_spec(1, width  = "2.7cm") %>%
                column_spec(2, width  = "0.7cm") %>%
                column_spec(3, width  = "2.7cm") %>%
                column_spec(4, width  = "1.2cm") %>%
                column_spec(5, width  = "1.7cm")      
```
\clearpage
